kmeansDilution.R
K. Beck
Jan. 8, 2013

**Objective:** Determine if k-means clustering across the log2 fold change between non-lactating and lactating states can better describe the dilution effect

**Secondary Objective:** Determine best clustering algorithm: PAM or CLARA or mixture

```{r echo=FALSE, message=FALSE}
# Load packages
library("fpc") # uses pam and clara
library("cluster")
library("knitr")
options(scipen = 10)
```

```{r echo=FALSE}
# silhouette rules
# if s(i) = 1, cluster appropriately
# if s(i) < 0, missclassified
# if s(i) = 0, can't tell if classified correctly


# # # # # # # # # # # # # # # # # # # # # #
#
#                FUNCTIONS
#
# # # # # # # # # # # # # # # # # # # # # #
printRelevant =
    function (pamobject) {
        cat("Mediods\n", pamobject$medoids, 
            "\nOverall average silhouette\n", pamobject$silinfo$avg.width, 
            "\nAver. silhouette by cluster\n", pamobject$silinfo$clus.avg.widths, "\n")
    }


pamPlain = 
    function(data, k = 3) {
        pamx = pam(data, k)
        printRelevant(pamx)
        return(pamx)
    }


kRangeClara =
    function(data, range, silrank = "multiasw", ns = 10, seed= 3) {
        pamkx = pamk(data, krange = range, 
                     criterion=silrank, 
                     usepam=FALSE, 
                     ns = ns, seed = seed,
                     critout = TRUE)
        cat("Optimal cluster size =", pamkx$nc, "\n")
        printRelevant(pamkx$pamobject)
        #cat("\nCluster Info\n")
        #pamkx$pamobject$clusinfo
        return(pamkx)
    }


claraPlain =
    function(data, k = 3) {
        clarax = clara(data, k = k, samples=50, pamLike=FALSE)        
        # set samples to be drawn from data set, 50 is recommended        
        printRelevant(clarax)
        # plot(clarax)
        return(clarax)
    }
```

</br>
</br>
**Cow** log 2 fold change pre-puberty to lactation
```{r echo = FALSE}
# # # # # # # # # # # # # # # # # # # # # #
#
#                CLUSTERING
#
# # # # # # # # # # # # # # # # # # # # # #

#### ---- Test CLARA w Estim. n of Clusters ---- ####
#kRangeClaraX = kRangeClara(qq, range= 2:10)
#plot(kRangeClaraX$pamobject)

#pamkx = pamk(hha$Change, krange = 2:10, criterion="multiasw", ns = 2, seed = 3, usepam=FALSE, critout = TRUE)

#pamkx$pamobject$silinfo$avg.width
#pamkx$pamobject$silinfo$clus.avg.widths
#pamkx$pamobject$clusinfo
#pamkx$pamobject$medoids

#summary(kRangeClaraXhh$pamobject)

# 1. Test clustering on log 2 of change on cow
cc = read.table("~/cowchange.txt", header=TRUE, sep="\t")
ccx = kRangeClara(cc$Change, range= 2:10)
cat("Cluster Info\n")
ccx$pamobject$clusinfo

cat("Explore different cluster sizes despite silhouettes")
cat("k = 6")
claraPlain(cc$Change, k=6)

```

</br>
**Human** log 2 fold change colostrum to mature milk
```{r echo=FALSE}
# 2. Test clustering on log 2 of change on human
hh = read.table("~/humanchange.txt", header=TRUE, sep="\t")
hhx = kRangeClara(hh$Change, range= 2:10)
cat("Cluster Info\n")
hhx$pamobject$clusinfo

cat("Explore different cluster sizes despite silhouettes")
cat("k = 3")
claraPlain(hh$Change, k=3)

cat("k = 6")
claraPlain(hh$Change, k=6)

```

</br>
**Cow** absolute change (lactation - pre-pub)
```{r echo=FALSE}
# 3. Test clustering of absolute change on cow
cca = read.table("~/tmp.txt", header=TRUE, sep="\t")
ccax = kRangeClara(cca$Change, range= 2:10, ns= 2, silrank="asw")
cat("Cluster Info\n")
ccax$pamobject$clusinfo


cat("Explore different cluster sizes despite silhouettes")
cat("k = 3")
claraPlain(cca$Change, k=3)
cat("k = 7")
claraPlain(cca$Change, k=7)
cat("k = 8")
claraPlain(cca$Change, k=8)
cat("k = 12")
claraPlain(cca$Change, k=12)

```

</br>
**Human** absolute change (mature - colostrum)
```{r echo=FALSE}
# 4. Test clustering of absolute change on human
hha = read.table("~/tmpHuman.txt", header=TRUE, sep="\t")
hhax = kRangeClara(hha$Change, range= 2:15, ns= 2, silrank="multiasw")
cat("Cluster Info\n")
hhax$pamobject$clusinfo

cat("Explore different cluster sizes despite silhouettes")
cat("k = 3")
claraPlain(hha$Change, k=3)

cat("k = 7")
claraPlain(hha$Change, k=7)

cat("k = 10")
claraPlain(hha$Change, k=10)

cat("k = 14")
claraPlain(hha$Change, k=14)



```









```{r echo = FALSE}

claraPlain(lactation$mean)

kRangeClara(lactation$mean, range=2:15)
kRangeClara(NRmature$mean, range=2:15)

## Unneeded code ##

# Notes: Separates out the 16 most enriched genes and provides the highest silhouette
# #### ---- Test k-means ---- ####
# fit = kmeans(tt$Change, centers = 3)
# 
# aggregate(tt$Change, by=list(fit$cluster), FUN = mean)
# 
# # Notes: gives cluster at expected centroids but does not report a goodness
# # metric like PAM... too basic for large data?
# # Cluster means: -2.76, -0.80, 2.23
# 
# #### ---- Test Clustering Large Applications (CLARA) ---- ####
# set.seed(3)
# claraPlain(tt$Change, k=2)
# 
# # Notes: With k = 3, this should perform the same as pamk, but they aren't and I don't know why.
# #### ---- Play with plots ---- ####
# range(tt$Change)
# options(scipen = 10)
# 
# plot(density(rnorm(n = 100, mean=pamkx$pamobject[[1]])))
# plot(pamkx$pamobject$medoids)
# 
# #### ---- Test Partitioning Around Medoids (PAM) ---- ####
# pamPlain(tt$Change)
# # Notes: Really slow, silhouette for third cluster is low, but within range of 
# # sample silhouette values in Reynolds et al (2006) Clustering Rules.
# pam will be slow on anything greater than 200 pts
```